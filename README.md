# Bookstore Chatbot

A Streamlit-based chatbot application that allows users to search for books and place orders using Google Gemini API (`gemini-2.0-flash-lite-001`) for natural language processing and SQLite for database management.

## Features
- **Search Books**: Users can search for books by title or author, retrieving details such as title, author, price, stock, and category.
- **Place Orders**: Users can create orders by providing customer name, phone number, address, book title, and quantity.
- **Interactive UI**: Built with Streamlit for a user-friendly web interface.
- **Function Calling**: Integrates Google Gemini API's function calling to handle book searches and order creation dynamically.
- **SQLite Database**: Stores book inventory and order details.

## Tech Stack
- **Python**: Core programming language.
- **Streamlit**: Web framework for the user interface.
- **Google Gemini API**: For natural language processing and function calling (`google-generativeai==0.8.5`).
- **SQLite**: Lightweight database for storing books and orders.
- **Proto-plus**: Dependency for Gemini API (`proto-plus==1.26.1`).

## Prerequisites
- Python 3.8+
- A Google API key for Gemini API (set up at [Google AI Studio](https://aistudio.google.com/)).
- Git installed for version control.
- A GitHub account for hosting the repository.

## Installation
1. **Clone the repository**:
   ```bash
   git clone https://github.com/tductam/bookstore-chatbot.git
   cd bookstore-chatbot
   ```

2. **Create and activate a virtual environment**:
   ```bash
   python -m venv .venv
   source .venv/bin/activate  # On Windows: .venv\Scripts\activate
   ```

3. **Install dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Set up the Google API key**:
   - Create a `.streamlit` directory and a `secrets.toml` file:
     ```bash
     mkdir .streamlit
     echo "GOOGLE_API_KEY = \"your-api-key-here\"" > .streamlit/secrets.toml
     ```
   - Replace `your-api-key-here` with your actual Google API key.

5. **Initialize the database**:
   ```bash
   python init_db.py
   ```
   This creates a `bookstore.db` file with sample book data and an orders table.

## Usage
1. **Run the application locally**:
   ```bash
   streamlit run app.py
   ```
   - Open your browser and go to `http://localhost:8501` to interact with the chatbot.
   - Example inputs:
     - "Tìm sách Đắc Nhân Tâm" → Returns book details.
     - "Mua 1 cuốn Nhà Giả Kim, tên A, sdt 0123456789, địa chỉ Hà Nội" → Creates an order.

2. **Expected outputs**:
   - Search: "Sách: Đắc Nhân Tâm, Tác giả: Dale Carnegie, Giá: 120000.0 VND, Tồn kho: 48, Thể loại: Kỹ năng sống"
   - Order: "Đã tạo đơn hàng thành công với mã #X cho sách 'Nhà Giả Kim'. Cảm ơn bạn!"

## Deployment
To deploy the application on Streamlit Cloud:
1. Push the code to a GitHub repository (see instructions below).
2. Log in to [Streamlit Cloud](https://streamlit.io/cloud).
3. Create a new app, select your GitHub repository, and specify `app.py` as the main file.
4. Add `GOOGLE_API_KEY` to the app's Secrets in Streamlit Cloud:
   - Go to the app's settings, add a secret with key `GOOGLE_API_KEY` and your API key as the value.
5. Deploy the app and access it via the provided URL.

## Project Structure
```
bookstore-chatbot/
├── .streamlit/
│   └── secrets.toml      # Stores Google API key (not tracked by Git)
├── .gitignore            # Ignores database, virtual env, and cache files
├── app.py                # Main Streamlit app
├── chatbot_gemini.py     # Chatbot logic with Gemini API
├── db_handler.py         # Database operations (search_book, create_order)
├── init_db.py            # Initializes SQLite database
├── requirements.txt      # Project dependencies
└── bookstore.db          # SQLite database (generated by init_db.py, not tracked by Git)
```

## Development Notes
- The chatbot uses function calling to map user inputs to `search_book` and `create_order` functions.
- History is limited to the last 10 messages to optimize performance.
- Quantity inputs are validated to ensure positive integers.
- Error handling distinguishes between API, database, and general errors.

## Troubleshooting
- **API errors**: Ensure `GOOGLE_API_KEY` is valid and correctly set in `.streamlit/secrets.toml`.
- **Database errors**: Run `python init_db.py` to recreate `bookstore.db`.
- **Unexpected responses**: Check console logs for `History`, `Function call`, and `Function response` to debug.

## Contributing
1. Fork the repository.
2. Create a feature branch: `git checkout -b feature-name`.
3. Commit changes: `git commit -m "Add feature"`.
4. Push to the branch: `git push origin feature-name`.
5. Open a pull request.

## License
MIT License